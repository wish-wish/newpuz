<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">

  <title>kodo(题目)</title>
  <script type="text/javascript">
  
	var isLe = (function() {
		var buf = new ArrayBuffer(2);
		new DataView(buf).setInt16(0, 256, true);
		var edianflag = new Int16Array(buf)[0] === 256;
		var da=new Date();
		if (edianflag) {
			console.log(da+"litten edian");
		} else {
			console.log(da+"big edian");
		}
		return edianflag;
	})();
		
	var removeLoading=function(){
		var gd=document;//.getElementById("GameDiv");
		var loading=document.getElementById("loading");
		if(gd&&loading)
		{
			//gd.removeChild(loading);
			loading.hidden=true;
			console.log("removeLoading 1");
		}
	}	
	setTimeout(function(){		
		var close=document.getElementById("close");
		if(close)
			close.hidden=false;				
	},6000);
	setTimeout(function(){
		removeLoading();
	},16000);
	var parseParams=function()
    {
        var ps=[];
        var params
        if(window.location.search.startsWith('?'))
            params=window.location.search.substr(1).split("&");
        else
            params=window.location.search.substr(0).split("&");
        for(var i=0;i<params.length;i++)
        {
            var nv=params[i].split("=");
            ps.push(nv);
        }
        ps.sort((a,b)=>{

            return a[0].localeCompare(b[0]);
        });
        return ps;
    }    	
	var query=function(pname)
	{
		let params=parseParams();
		for(let i=0;i<params.length;i++)
		{
			if(params[i][0]==pname)//puzzle
			{
				if(params[i][1].length>0)
				{
					let num=Number.parseInt(params[i][1]);
					return num;
				}
			}
		}
		return 0;
	}
	
	var toData=function(datastr)
    {
        var arrData = new Uint16Array(datastr.length);
        for (var i = 0; i < datastr.length; i++) {
            arrData[i] = datastr.charCodeAt(i);
        }
        return arrData;
    }
	window.onload=function()
	{
		var addr="ws://www.5icoin.com:9818";
		if(window.location.href.startsWith("https://"))
			addr="wss://www.5icoin.com:9817";
		let socket=new WebSocket(addr); 
        socket.binaryType = "arraybuffer";
		var num=query("num")
		if(num<2)num=7;
		var alien=query("alien");
        socket.onopen = function(evt) { 			
			var str="rubric:num:"+num;
			if(alien>0);
				str+=":alien:1";
            socket.send(toData(str));
        };
        socket.onmessage = function(evt) {              
            var array = new Uint8Array(evt.data);
            var str = "";
            for (var i = 0; i < array.length; i++) {
                str = str + String.fromCharCode(array[i]);
            }
			var subject=str.split(":");
            document.getElementById("subject").innerText=subject[3]+"\n"+subject[1]+"\n"+subject[5];
            console.log("recv:"+str.length);            
            socket.close();
        };
        socket.onerror = function(evt) {            
            socket.close();            
        };
        socket.onclose = function(evt) {
            socket.close();            
        };
	}
  </script>
</head>
<body>
<div id="subject"></div>	
  <!--div id="loading">拼命加载中....<button id="close" type="button" onclick=removeLoading() hidden=true>X</button></div-->	
</div>

</body>
</html>
